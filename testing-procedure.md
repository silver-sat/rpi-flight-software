# Testing Procedure

This document describes the various procedures that can be used to test the payload board by interacting with the installed raspberry pi. The raspberry pi should be setup and configured as described in the [New Image](newimage.md) document. In particular, this will configure the raspberry pi with the rpi-flight-software repository contents and set the raspberry pi to execute one of the setups automatically at bootup.

## Testing configuration: Payload board using WiFi for internet connection

The setup `satellite-gpio-ucam-test` is appropriate for this scenario. This setup presumes that the Raspberry Pi will connect to WiFi SSID `SilverSat` with password `silversat` in order to access the internet. This setup also assumes there is a uCAM III camera installed, and will either execute the photo or the tweet mode payload task at bootup depending on the status of the payload board STATES pins. Once the payload board is turned on by the avionics board, it will connect to the WiFi and should be able to be accessed using SSH (lookup with IP address it gets with whatever tools you have available). You should access the raspberry pi with username `pi` and password `silversat`. Once logged in via SSH you can monitor the payload tasks using typcal linux command-line tools. The `.startup.log` file in the `pi` user's home directory records any output generated by the primary startup script run at boot up.

In addition to the payload baord, this testing procedure requires an internet connected WiFi router or hotspot to make the internet available to the raspberry pi. Windows 11 has a convenient hotspot feature that will be used for this purpose below.

### Preparation for testing 

1. In Windows 11, under Settings, Network & Internet select "Mobile hotspot". Configure the hotspot to use the SSID "SilverSat",  password "silversat", and the "2.4GHz" band. Turn off "Power saving". Turn the hotspot to "on". Note that the Windows 11 computer must be connected to the internet, generally by its own WiFi connection.

2. If photo mode is desired on the payload board, connect the jumper header pins 3,4,5 (states) to GND to pull them low to indicate photo mode.

### Observation of Tweets

1. Go to the URL: [NathanE15158060](https://twitter.com/NathanE15158060)

### Observation during testing

1. Once the raspberry pi has turned on, wait for it to connect to the SilverSat SSID - this will show up in the "Devices connected" section of the "Mobile hotspot" configuration. Make a note of the IP address it is assigned. It will likely keep this IP address for the whole session.

2. Open the Windows 11 Terminal - type `cmd` in the Windows 11 Search and select the "Command Prompt App".

3. At the prompt, enter the following command `ssh pi@<IP>` where `<IP>` is the IP address noted in step 1.

4. Use the password `silversat` to log into the running raspberry pi.

5. Note that the time will likely be wrong. use `sudo ntpdate -u 0.pool.ntp.org` to set the time. 

6. Check the contents of the `.startup.log` file in the home directory of the `pi` user: `tail -f .startup.log`

7. Old startup logs are at `.startup.log.1`, `.startup.log.2`, etc. so you can see what happened during previous payload bootups. The last 10 log files are retained.

8. The raspberry pi will shutdown as soon as the tweet or photo mode program has run. To stop this from happening, kill the .startup.sh process: `sudo pkill -9 -f .startup.sh`

9. Alternatively, create the file `.noshutdown` in `/home/pi` to stop the RPi startup script shuting down after it attempts the photo (or tweet): `touch ~/.noshutdown`

10. Check the directory `~/photos` for evidence of a photo.

11. To execute the tweet or photo mode scripts on a raspberry pi outside the the bootup procedure change directory to the payload directory and execute `python3 photo.py` or `python3 tweet.py`.

## Testing configuration: Raspberry Pi without Payload board using WiFi for internet connection

1. Use a micro-USB cable from the laptop or use another source of +5V and GND to power the raspberry pi (pins 2 and 6). 

2. In the absence of the payload board and triple voted STATES lines, the `satellite-gpio-ucam-test` setup will monitor the GPIO pins 29, 31, 33, 35 to check which of 29, 31, 33 is connected by a jumper wire to pin 35.
  * If pin 29 is connected to pin 35, the rapberry pi will execute the tweet mode code and shutdown;
  * If pin 31 is connected to pin 35, it will execute the photo mode code and shutdown;
  * If pin 33 is connected to pin 35, it will boot up and not shutdown. 
The last option makes it possible to ssh into the raspberry pi without it shuting down unexpectedly.

3. To execute the tweet or photo mode scripts on a raspberry pi outside the the bootup procedure change directory to the payload directory and execute `python3 photo.py` or `python3 tweet.py`.



